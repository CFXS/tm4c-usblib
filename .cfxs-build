printf("Load TM4C usblib")
tm4c_usblib = create_library("tm4c-usblib")
tm4c_usblib:add_include_paths("public", {"./"})

tm4c_usblib:create_precompiled_header({
    "<stdint.h>",
    "<stddef.h>",
})

if _G.CFXS_TOOLCHAIN == "GCC" or _G.CFXS_TOOLCHAIN == "Clang" then
    tm4c_usblib:add_compile_options("private", {
        "-Wno-missing-field-initializers",
        "-Wno-unused-but-set-variable",
    })
else
    error("Toolchain [".._G.CFXS_TOOLCHAIN.."] not implemented")
end

assert(tm4c_driverlib ~= nil, "tm4c_driverlib not imported")
tm4c_usblib:add_libraries(tm4c_driverlib)

local CONFIG_TEMPLATE = [[
_G.CONFIG_TM4C_USBLIB = {
    type = "host" | "device" | "host/device"
}
]]
assert(_G.CONFIG_TM4C_USBLIB ~= nil, "_G.CONFIG_TM4C_USBLIB not defined\n"..CONFIG_TEMPLATE)

-- Base sources
tm4c_usblib:add_sources("./usblib/*.c")

if _G.CONFIG_TM4C_USBLIB.type == "host" then
    tm4c_usblib:add_sources("./usblib/host/*.c")
elseif _G.CONFIG_TM4C_USBLIB.type == "device" then
    tm4c_usblib:add_sources("./usblib/device/*.c")
elseif _G.CONFIG_TM4C_USBLIB.type == "host/device" or _G.CONFIG_TM4C_USBLIB.type == "device/host" then
    tm4c_usblib:add_sources("./usblib/host/*.c")
    tm4c_usblib:add_sources("./usblib/device/*.c")
else
    assert(false, "Invalid _G.CONFIG_TM4C_USBLIB.type: "..tostring(_G.CONFIG_TM4C_USBLIB.type))
end
